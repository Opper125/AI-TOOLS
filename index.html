<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Website Builder - Myanmar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Myanmar Text', sans-serif;
        }
        .myanmar-text {
            font-family: 'Myanmar Text', 'Pyidaungsu', 'Padauk', sans-serif;
        }
        .code-editor {
            font-family: 'Courier New', monospace;
            tab-size: 4;
        }
        .loading-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .file-item {
            transition: all 0.3s ease;
        }
        .file-item:hover {
            transform: translateY(-2px);
        }
        .preview-frame {
            border: none;
            width: 100%;
            height: 100%;
            background: white;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .code-block {
            max-height: 400px;
            overflow-y: auto;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button.active {
            background-color: #3b82f6;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-robot text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">AI Website Builder</h1>
                        <p class="text-blue-100 myanmar-text">အင်တာနက်စာမျက်နှာ ဖန်တီးရေး AI ကူညီပေးစနစ်</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="glass-effect px-4 py-2 rounded-lg">
                        <i class="fas fa-circle text-green-400"></i>
                        <span class="ml-2">အချိန်ကာလအကန့်မရှိ</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Left Panel - AI Chat Interface -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6">
                    <h2 class="text-xl font-semibold flex items-center">
                        <i class="fas fa-comments mr-3"></i>
                        AI နဲ့ စကားပြောရန်
                    </h2>
                    <p class="mt-2 text-blue-100">သင်လိုချင်တဲ့ website ကို AI နဲ့ ဖန်တီးနိုင်ပါသည်</p>
                </div>

                <!-- File Upload Section -->
                <div class="p-6 border-b">
                    <h3 class="font-semibold mb-4 myanmar-text">ဖိုင်များ တင်ရန်</h3>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors cursor-pointer" id="dropZone">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 myanmar-text">ဖိုင်များကို ဤနေရာတွင် ထည့်ပါ သို့မဟုတ် ကလစ်နှိပ်ပါ</p>
                        <input type="file" id="fileInput" multiple class="hidden" accept="*/*">
                        <button onclick="document.getElementById('fileInput').click()" class="mt-4 bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-folder-open mr-2"></i>ဖိုင်ရွေးချယ်ရန်
                        </button>
                    </div>

                    <!-- Uploaded Files Display -->
                    <div id="uploadedFiles" class="mt-4 space-y-2"></div>
                </div>

                <!-- Chat Interface -->
                <div class="p-6">
                    <div id="chatHistory" class="space-y-4 mb-6 max-h-96 overflow-y-auto">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-robot text-blue-500 mt-1"></i>
                                <div>
                                    <p class="font-medium text-blue-800">AI Assistant</p>
                                    <p class="text-gray-700 myanmar-text">မင်္ဂလာပါ! ကျွန်တော်က AI Website Builder ပါ। သင့်အတွက် website တစ်ခု ဖန်တီးပေးနိုင်ပါတယ်။ ဘာလုပ်ချင်တယ်လို့ ပြောပါ။</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-2">
                        <input type="text" id="userInput" placeholder="သင့်လိုအပ်ချက်များကို ရေးပါ..." class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 myanmar-text" onkeypress="handleKeyPress(event)">
                        <button onclick="sendMessage()" id="sendBtn" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Code Output and Preview -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <!-- Tabs -->
                <div class="flex border-b">
                    <button onclick="switchTab('code')" class="tab-button flex-1 px-6 py-4 font-medium hover:bg-gray-50 transition-colors active">
                        <i class="fas fa-code mr-2"></i>ကုဒ်များ
                    </button>
                    <button onclick="switchTab('preview')" class="tab-button flex-1 px-6 py-4 font-medium hover:bg-gray-50 transition-colors">
                        <i class="fas fa-eye mr-2"></i>ကြိုတင်ကြည့်ရှုရန်
                    </button>
                </div>

                <!-- Code Tab -->
                <div id="codeTab" class="tab-content active">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-semibold myanmar-text">ဖန်တီးထားသော ကုဒ်များ</h3>
                            <div class="space-x-2">
                                <button onclick="copyAllCode()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                                    <i class="fas fa-copy mr-2"></i>ကူးယူရန်
                                </button>
                                <button onclick="downloadFiles()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                                    <i class="fas fa-download mr-2"></i>ဒေါင်းလုဒ်
                                </button>
                            </div>
                        </div>
                        <div id="codeOutput" class="space-y-4">
                            <div class="bg-gray-50 p-4 rounded-lg text-center text-gray-500 myanmar-text">
                                AI က ကုဒ်များ ရေးပေးပါမယ်...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preview Tab -->
                <div id="previewTab" class="tab-content">
                    <div class="h-96">
                        <iframe id="previewFrame" class="preview-frame" src="about:blank"></iframe>
                    </div>
                    <div class="p-4 bg-gray-50 border-t">
                        <button onclick="refreshPreview()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i>ပြန်လည်ခွင့်တင်ရန်
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl p-8 max-w-md mx-4">
            <div class="text-center">
                <div class="loading-animation inline-block w-8 h-8 bg-blue-500 rounded-full mb-4"></div>
                <h3 class="text-xl font-semibold mb-2 myanmar-text">AI က အလုပ်လုပ်နေပါသည်...</h3>
                <p class="text-gray-600 myanmar-text">ကုဒ်များကို ဖန်တီးနေပါသည်။ ခဏစောင့်ပါ...</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let uploadedFiles = [];
        let generatedFiles = {};
        let currentTab = 'code';
        
        // Environment variable for API key (should be set in Netlify)
        const GEMINI_API_KEY = 'AIzaSyCOJ7PqrIcotDtohVor1E0mRpGWOGvxLgE';

        // File upload functionality
        document.getElementById('fileInput').addEventListener('change', handleFileUpload);
        document.getElementById('dropZone').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });

        // Drag and drop functionality
        const dropZone = document.getElementById('dropZone');
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-blue-400', 'bg-blue-50');
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-400', 'bg-blue-50');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-400', 'bg-blue-50');
            const files = Array.from(e.dataTransfer.files);
            processFiles(files);
        });

        function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            processFiles(files);
        }

        function processFiles(files) {
            files.forEach(file => {
                const fileObj = {
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    file: file,
                    content: null
                };

                // Read file content
                const reader = new FileReader();
                reader.onload = (e) => {
                    fileObj.content = e.target.result;
                    uploadedFiles.push(fileObj);
                    displayUploadedFiles();
                };

                if (file.type.startsWith('text/') || file.name.endsWith('.html') || file.name.endsWith('.css') || file.name.endsWith('.js') || file.name.endsWith('.json') || file.name.endsWith('.xml')) {
                    reader.readAsText(file);
                } else {
                    reader.readAsDataURL(file);
                    fileObj.content = 'Binary file content';
                    uploadedFiles.push(fileObj);
                    displayUploadedFiles();
                }
            });
        }

        function displayUploadedFiles() {
            const container = document.getElementById('uploadedFiles');
            container.innerHTML = '';

            uploadedFiles.forEach(file => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'file-item flex items-center justify-between bg-gray-50 p-3 rounded-lg';
                fileDiv.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-file text-gray-500"></i>
                        <div>
                            <p class="font-medium text-sm">${file.name}</p>
                            <p class="text-xs text-gray-500">${formatFileSize(file.size)}</p>
                        </div>
                    </div>
                    <button onclick="removeFile('${file.id}')" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(fileDiv);
            });
        }

        function removeFile(fileId) {
            uploadedFiles = uploadedFiles.filter(file => file.id != fileId);
            displayUploadedFiles();
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Chat functionality
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;

            // Add user message to chat
            addMessageToChat('user', message);
            input.value = '';

            // Show loading
            showLoading();

            try {
                // Call Gemini AI
                const response = await callGeminiAI(message);
                hideLoading();
                
                // Add AI response to chat
                addMessageToChat('ai', response.text || 'ကုဒ်များကို ဖန်တီးပြီးပါပြီ။');

                // If response contains code, display it
                if (response.files && response.files.length > 0) {
                    displayGeneratedCode(response.files);
                    switchTab('code');
                }

            } catch (error) {
                hideLoading();
                addMessageToChat('ai', 'တောင်းပန်ပါတယ်။ အမှားတစ်ခု ဖြစ်ပွားခဲ့ပါသည်။ ထပ်စမ်းကြည့်ပါ။');
                console.error('Error:', error);
            }
        }

        function addMessageToChat(sender, message) {
            const chatHistory = document.getElementById('chatHistory');
            const messageDiv = document.createElement('div');
            
            if (sender === 'user') {
                messageDiv.className = 'bg-gray-100 p-4 rounded-lg';
                messageDiv.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-user text-gray-500 mt-1"></i>
                        <div>
                            <p class="font-medium text-gray-800">သင်</p>
                            <p class="text-gray-700 myanmar-text">${message}</p>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.className = 'bg-blue-50 p-4 rounded-lg';
                messageDiv.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-robot text-blue-500 mt-1"></i>
                        <div>
                            <p class="font-medium text-blue-800">AI Assistant</p>
                            <p class="text-gray-700 myanmar-text">${message}</p>
                        </div>
                    </div>
                `;
            }
            
            chatHistory.appendChild(messageDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        async function callGeminiAI(userMessage) {
            // Prepare the prompt with file context
            let prompt = `သင်သည် အင်္ဂလိပ်မြန်မာစာ website builder AI ဖြစ်ပါသည်။ အသုံးပြုသူ၏တောင်းဆိုချက်ကို လက်ခံပြီး website ကုဒ်များကို ဖန်တီးပေးပါ။

အသုံးပြုသူ၏တောင်းဆိုချက်: ${userMessage}

`;

            // Add uploaded files context
            if (uploadedFiles.length > 0) {
                prompt += "\n\nတင်ထားသော ဖိုင်များ:\n";
                uploadedFiles.forEach(file => {
                    prompt += `ဖိုင်အမည်: ${file.name}\n`;
                    if (file.content && file.content !== 'Binary file content') {
                        prompt += `ဖိုင်အကြောင်းအရာ:\n${file.content}\n\n`;
                    }
                });
            }

            prompt += `\n\nတောင်းဆိုချက်များ:
1. အပြည့်အစုံ HTML, CSS, JavaScript ကုဒ်များကို ရေးပေးပါ
2. Modern responsive design သုံးပါ
3. Myanmar Unicode font support ထည့်ပေးပါ
4. ကုဒ်များကို သပ်သပ်ရပ်ရပ် ရေးပေးပါ
5. အကန့်အသတ်မရှိ ရေးပေးပါ

ပြန်ပေးရမည်: JSON format ဖြင့် { "text": "မြန်မာဖြင့်ရှင်းပြချက်", "files": [{"name": "filename.html", "content": "file content"}] }`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }]
                })
            });

            if (!response.ok) {
                throw new Error('API call failed');
            }

            const data = await response.json();
            const aiResponse = data.candidates[0].content.parts[0].text;

            // Try to parse as JSON, if not, create a simple response
            try {
                return JSON.parse(aiResponse);
            } catch (e) {
                // If not JSON, treat as HTML content
                return {
                    text: "ကုဒ်များကို ဖန်တီးပြီးပါပြီ။",
                    files: [{
                        name: "index.html",
                        content: aiResponse
                    }]
                };
            }
        }

        function displayGeneratedCode(files) {
            const codeOutput = document.getElementById('codeOutput');
            codeOutput.innerHTML = '';

            // Store generated files
            generatedFiles = {};
            files.forEach(file => {
                generatedFiles[file.name] = file.content;
            });

            files.forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'bg-gray-50 rounded-lg overflow-hidden';
                fileDiv.innerHTML = `
                    <div class="bg-gray-800 text-white px-4 py-2 flex justify-between items-center">
                        <span class="font-mono text-sm">${file.name}</span>
                        <button onclick="copyCode('${file.name}')" class="text-gray-300 hover:text-white">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="code-block">
                        <pre class="code-editor p-4 text-sm overflow-x-auto"><code id="code-${index}">${escapeHtml(file.content)}</code></pre>
                    </div>
                `;
                codeOutput.appendChild(fileDiv);
            });

            // Auto-update preview if HTML file exists
            if (generatedFiles['index.html']) {
                updatePreview();
            }
        }

        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function copyCode(filename) {
            const content = generatedFiles[filename];
            navigator.clipboard.writeText(content).then(() => {
                // Show success message
                const button = event.target.closest('button');
                const originalIcon = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i>';
                setTimeout(() => {
                    button.innerHTML = originalIcon;
                }, 2000);
            });
        }

        function copyAllCode() {
            let allCode = '';
            Object.entries(generatedFiles).forEach(([filename, content]) => {
                allCode += `<!-- ${filename} -->\n${content}\n\n`;
            });
            
            navigator.clipboard.writeText(allCode).then(() => {
                alert('အားလုံးကုဒ်များကို ကူးယူပြီးပါပြီ!');
            });
        }

        function downloadFiles() {
            Object.entries(generatedFiles).forEach(([filename, content]) => {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }

        // Tab functionality
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`button[onclick="switchTab('${tabName}')"]`).classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + 'Tab').classList.add('active');

            currentTab = tabName;
        }

        // Preview functionality
        function updatePreview() {
            const previewFrame = document.getElementById('previewFrame');
            
            if (generatedFiles['index.html']) {
                const htmlContent = generatedFiles['index.html'];
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                previewFrame.src = url;
                
                // Clean up previous URL
                setTimeout(() => {
                    URL.revokeObjectURL(url);
                }, 1000);
            }
        }

        function refreshPreview() {
            updatePreview();
        }

        // Loading modal
        function showLoading() {
            document.getElementById('loadingModal').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingModal').classList.add('hidden');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('AI Website Builder initialized successfully!');
        });
    </script>
</body>
</html>
